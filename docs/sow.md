# Chrome ブックマーク MCP サーバー 作業範囲記述書（SoW）

## 1. **プロジェクト概要**

### 1.1 目的
macOS 上の Chrome ブラウザのブックマークデータを、MCP（Model Context Protocol）を通じて AI エージェントが活用できる形で提供するサーバーを構築する。

### 1.2 スコープ
- Chrome ブックマークの読み取り（読み取り専用）
- ブックマークの階層構造を保持したデータ提供
- ブックマークされたページのコンテンツとメタデータの取得
- AI エージェントが効率的に利用できる検索・取得インターフェースの提供

## 2. **機能要件**

### 2.1 ブックマークデータ読み取り機能
- **対象ファイル**: `~/Library/Application Support/Google/Chrome/Default/Bookmarks`
- **データ形式**: JSON 形式のブックマークファイルをパース
- **読み取りタイミング**: リクエスト時に都度読み込み（キャッシュなし）
- **構造保持**: フォルダ階層構造を維持したまま提供

### 2.2 データ提供内容
各ブックマークエントリーに対して以下の情報を提供：

#### 基本情報
- タイトル
- URL
- 追加日時
- 最終更新日時
- フォルダパス（階層構造内の位置）

#### ページメタデータ
- OGP（Open Graph Protocol）情報
  - og:title
  - og:description
  - og:image
  - og:type
- ページのdescriptionメタタグ
- ファビコンURL

#### ページコンテンツ
- ページ全文（HTMLから抽出したテキスト）
- 主要コンテンツ（記事本文等）の抽出
- ページタイトル（実際のHTMLから取得）

### 2.3 MCP インターフェース仕様

#### リソース提供
1. **ブックマークツリー全体**
   - URI: `bookmark://tree`
   - 完全な階層構造を JSON 形式で提供

2. **特定フォルダのコンテンツ**
   - URI: `bookmark://folder/{folder_path}`
   - 指定フォルダ内のブックマークを提供

#### ツール提供
1. **search_bookmarks**
   - ブックマーク検索機能
   - 検索対象：タイトル、URL、ページコンテンツ
   - フォルダ指定による検索範囲の限定が可能

2. **get_bookmark_content**
   - 特定URLのブックマークに対する詳細情報取得
   - コンテンツ取得のON/OFF制御
   - メタデータ取得のON/OFF制御

3. **list_bookmark_folders**
   - 全フォルダパスの一覧取得
   - 階層構造の把握用

## 3. **非機能要件**

### 3.1 パフォーマンス
- ブックマーク読み取り：1000件のブックマークを1秒以内に処理
- コンテンツ取得：並行処理により複数ページを効率的に取得
- レスポンス時間：基本情報のみの場合は100ms以内

### 3.2 エラーハンドリング
- **ブックマークファイル不在**: 明確なエラーメッセージを返す
- **権限エラー**: ファイルアクセス権限がない場合の適切なエラー通知
- **ネットワークエラー**: ページコンテンツ取得失敗時の graceful degradation
- **パースエラー**: 不正な形式のブックマークファイルへの対処

### 3.3 互換性
- **OS**: macOS（最新版および過去2メジャーバージョン）
- **Chrome**: 最新安定版および過去3バージョン
- **MCP**: modelcontextprotocol/rust-sdk の最新版に準拠

## 4. **制約事項**

### 4.1 技術的制約
- Rust 言語で実装
- MCP rust-sdk を使用
- 読み取り専用（ブックマークの変更は行わない）
- Chrome のブックマークファイル形式に依存

### 4.2 セキュリティ制約
- ローカルファイルシステムへのアクセスは最小限に限定
- 外部URLへのアクセス時はユーザーエージェントを適切に設定
- 認証が必要なページのコンテンツは取得しない

## 5. **成果物**

### 5.1 ソフトウェア成果物
- MCP サーバー実行可能バイナリ
- ソースコード一式
- 設定ファイルテンプレート

### 5.2 ドキュメント成果物
- インストール手順書
- API仕様書（MCP インターフェース詳細）
- トラブルシューティングガイド

## 6. **受け入れ基準**

### 6.1 機能テスト
- Chrome ブックマークの全階層が正しく読み取れること
- 検索機能が期待通りに動作すること
- ページコンテンツとメタデータが正確に取得できること

### 6.2 エラーケーステスト
- ブックマークファイルが存在しない場合の適切なエラー処理
- ネットワーク接続がない場合の graceful degradation
- 不正なURLや取得できないページへの対処

### 6.3 パフォーマンステスト
- 1000件のブックマークで規定のレスポンス時間を満たすこと
- メモリ使用量が適切であること

## 7. **除外事項**

- ブックマークの作成・更新・削除機能
- Chrome 以外のブラウザ対応
- Windows/Linux 対応
- リアルタイムでのブックマーク変更監視
- 認証が必要なページのコンテンツ取得
- ブックマークのエクスポート/インポート機能
- GUI/Web インターフェース

## 8. **前提条件**

- macOS 環境であること
- Chrome がインストールされていること
- ブックマークファイルへの読み取り権限があること
- インターネット接続（ページコンテンツ取得時）